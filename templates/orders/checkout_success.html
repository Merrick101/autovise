<!-- templates/orders/checkout_success.html -->

{% extends "base.html" %}
{% block content %}
  <div class="container mt-5">
    <h2>ðŸŽ‰ Order Confirmed</h2>

    {% if order %}
      <p>
        Thank you for your purchase{% if order.user %}, {{ order.user.username }}{% endif %}!
      </p>
      <p>Order <strong>#{{ order.id }}</strong> has been confirmed.</p>

      <h4>Order Summary:</h4>
      <ul class="list-unstyled">
        {% for item in order.items.all %}
          <li>
            {% if item.bundle %}
              {{ item.quantity }} Ã—
              <strong>{{ item.bundle.name }}</strong>
              (Bundle) â€“ Â£{{ item.unit_price|floatformat:2 }}
            {% else %}
              {{ item.quantity }} Ã—
              {{ item.product.name }} â€“ Â£{{ item.unit_price|floatformat:2 }}
            {% endif %}
          </li>
        {% endfor %}
      </ul>

      <p><strong>Subtotal:</strong> Â£{{ order.total_amount|floatformat:2 }}</p>

      {% if order.discount_total and order.discount_total > 0 %}
        <p><strong>Discount Applied:</strong> -Â£{{ order.discount_total|floatformat:2 }}</p>
      {% endif %}

      {% if order.delivery_fee is not None %}
        <p>
          <strong>Delivery Fee:</strong>
          {% if order.delivery_fee|floatformat:2 == "0.00" %}
            <span class="text-success">Free</span>
          {% else %}
            Â£{{ order.delivery_fee|floatformat:2 }}
          {% endif %}
        </p>
      {% endif %}

      <p><strong>Total Paid:</strong> Â£{{ order.total_price|floatformat:2 }}</p>
    
      {% else %}
      <p>
        Your order has been received, but no details could be loaded.
        If you believe this is an error, please contact support.
      </p>
    {% endif %}

    <p>
      If you have any questions, please
      <a href="{{ contact_page_url|default:'#contact' }}">contact support</a>
      or email us at
      <a href="mailto:{{ support_email|default:settings.SUPPORT_EMAIL }}">{{ support_email|default:settings.SUPPORT_EMAIL }}</a>.
    </p>

    <a href="{% url 'products:product_list' %}" class="btn btn-primary mt-3">
      Continue Shopping
    </a>
  </div>
{% endblock %}
