<!-- templates/orders/inline_checkout.html -->

{% extends "base.html" %}
{% load static %}
{% block content %}

<div class="container mt-5">
  <h2>Secure Checkout</h2>

  <!-- Scoped config lives on this root element -->
  <div id="inline-checkout"
       data-pk="{{ stripe_publishable_key }}"
       data-create-url="{% url 'orders:create_payment_intent' %}"
       data-update-url="{% url 'orders:update_payment_intent' %}"
       data-success-url="{{ success_url }}">

    <form id="payment-form">
      {% csrf_token %}
      {% if not request.user.is_authenticated %}
        <div class="mb-3">
          <label for="guest_email" class="form-label">Email for receipt (optional)</label>
          <input id="guest_email" name="guest_email" type="email" class="form-control" placeholder="you@example.com">
        </div>
      {% endif %}

      <!-- Shipping Address -->
      <div class="card mt-3">
        <div class="card-header">Shipping address</div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-md-6">
              <label for="shipping_name" class="form-label">Full name</label>
              <input id="shipping_name" name="shipping_name" type="text" class="form-control" required>
            </div>
            <div class="col-md-6">
              <label for="shipping_phone" class="form-label">Phone (optional)</label>
              <input id="shipping_phone" name="shipping_phone" type="tel" class="form-control">
            </div>

            <div class="col-12">
              <label for="shipping_line1" class="form-label">Address line 1</label>
              <input id="shipping_line1" name="shipping_line1" type="text" class="form-control" required>
            </div>
            <div class="col-12">
              <label for="shipping_line2" class="form-label">Address line 2 (optional)</label>
              <input id="shipping_line2" name="shipping_line2" type="text" class="form-control">
            </div>

            <div class="col-md-6">
              <label for="shipping_city" class="form-label">City / Town</label>
              <input id="shipping_city" name="shipping_city" type="text" class="form-control" required>
            </div>
            <div class="col-md-3">
              <label for="shipping_postcode" class="form-label">Postcode</label>
              <input id="shipping_postcode" name="shipping_postcode" type="text" class="form-control" required>
            </div>
            <div class="col-md-3">
              <label for="shipping_country" class="form-label">Country</label>
              <select id="shipping_country" name="shipping_country" class="form-select" required>
                <option value="GB" selected>United Kingdom</option>
                <option value="IE">Ireland</option>
                <!-- Optional: add others as needed -->
              </select>
            </div>
          </div>
        </div>
      </div>

      <div id="payment-element"><!-- Stripe mounts here --></div>

      <button id="submit" class="btn btn-primary mt-3" type="submit" disabled>
        Pay Now
        <span id="spinner" class="spinner-border spinner-border-sm ms-2 d-none" role="status" aria-hidden="true"></span>
      </button>

      <div id="error-message" class="text-danger mt-2" role="alert"></div>
    </form>
  </div>
</div>

<!-- Stripe.js -->
<script src="https://js.stripe.com/v3/"></script>

{% endblock %}
