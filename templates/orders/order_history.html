{% extends "base.html" %}
{% load static %}
{% block content %}

<div class="container mt-5">
  <h2>ðŸ§¾ Your Order History</h2>

  {% if request.user.is_authenticated and request.user.order_set.exists %}
    {% for order in request.user.order_set.all|dictsortreversed:"created_at" %}
      <div class="card mb-4 mt-3">
        <div class="card-header">
          <strong>Order #{{ order.id }}</strong> â€” {{ order.created_at|date:"F j, Y" }}
        </div>
        <div class="card-body">
          <ul class="list-unstyled">
            {% for item in order.items.all %}
              <li>
                {% if item.bundle %}
                  {{ item.quantity }} Ã— {{ item.bundle.name }} â€” Â£{{ item.subtotal|floatformat:2 }}
                {% else %}
                  {{ item.quantity }} Ã— {{ item.product.name }} â€” Â£{{ item.subtotal|floatformat:2 }}
                {% endif %}
              </li>
            {% endfor %}
          </ul>
          <p class="mt-2"><strong>Total:</strong> Â£{{ order.total_price|floatformat:2 }}</p>
          {% if order.is_paid %}
            <span class="badge bg-success">Paid</span>
          {% elif order.payment_status == "failed" %}
            <span class="badge bg-danger">Failed</span>
          {% elif order.payment_status == "requires_action" %}
            <span class="badge bg-warning text-dark">Action required</span>
          {% else %}
            <span class="badge bg-secondary">Processing</span>
          {% endif %}
        </div>
      </div>
    {% endfor %}
  {% else %}
    <p>You haven't placed any orders yet.</p>
  {% endif %}
</div>
{% endblock %}
